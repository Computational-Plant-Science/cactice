from pprint import pprint

import numpy as np

from cactice.io import read_tiles, read_tile, read_csv

tiles_path = 'testdata/tiles_sample1.txt'
csv_path = 'testdata/grids_sample1.csv'


def test_read_tile():
    pass


def test_read_file():
    expected = sorted([
        sorted([[0, 28], [1, 28], [2, 28], [3, 28], [2, 29]]),
        sorted([[1, 2], [1, 3], [1, 4], [2, 3], [3, 3]]),
        sorted([[1, 13], [2, 13], [3, 13], [3, 14], [3, 15]]),
        sorted([[1, 18], [2, 18], [2, 19], [3, 19], [3, 20]]),
        sorted([[1, 24], [2, 23], [2, 24], [2, 25], [3, 24]]),
        sorted([[2, 7], [2, 9], [3, 7], [3, 8], [3, 9]]),
        sorted([[5, 7], [6, 7], [7, 7], [8, 7], [9, 7]]),
        sorted([[5, 10], [6, 10], [7, 10], [8, 10], [8, 11]]),
        sorted([[5, 19], [6, 19], [7, 18], [7, 19], [8, 18]]),
        sorted([[6, 3], [6, 4], [7, 2], [7, 3], [8, 3]]),
        sorted([[6, 14], [6, 15], [6, 15], [7, 14], [7, 15], [8, 14]]),
        sorted([[6, 22], [6, 23], [7, 23], [8, 23], [8, 24]])
    ])

    actual = read_tiles(tiles_path)
    # pprint(actual)

    for tile in expected: assert tile in actual
    for tile in actual: assert tile in expected


def test_read_csv():
    expected = [
        # grid 34
        [[3, 0, 0, 4, 4, 3, 1, 3, 1, 3, 0, 4, 1, 0, 1, 4],
         [4, 2, 4, 0, 4, 2, 0, 2, 1, 4, 1, 2, 4, 1, 1, 3],
         [4, 0, 3, 4, 1, 1, 4, 2, 1, 4, 3, 2, 2, 0, 2, 0],
         [2, 1, 1, 0, 3, 4, 4, 1, 2, 0, 2, 3, 1, 2, 2, 3],
         [0, 4, 2, 2, 4, 0, 0, 1, 3, 1, 0, 0, 4, 2, 1, 1],
         [4, 4, 0, 3, 4, 4, 2, 2, 1, 0, 4, 4, 3, 2, 2, 2],
         [1, 4, 4, 4, 4, 4, 3, 4, 0, 4, 1, 3, 1, 1, 4, 4],
         [1, 1, 1, 4, 0, 4, 1, 1, 1, 2, 4, 1, 3, 4, 0, 4],
         [2, 2, 1, 4, 2, 1, 4, 3, 2, 1, 2, 0, 4, 2, 4, 2],
         [2, 0, 1, 4, 3, 1, 2, 1, 0, 0, 2, 2, 2, 1, 4, 1],
         [2, 2, 2, 4, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4],
         [3, 1, 4, 2, 3, 2, 4, 1, 0, 1, 1, 1, 1, 4, 3, 2],
         [4, 2, 1, 2, 0, 4, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0],
         [1, 0, 0, 0, 0, 0, 4, 0, 1, 4, 3, 3, 2, 3, 0, 1],
         [4, 0, 1, 0, 0, 0, 0, 0, 0, 0, 4, 4, 3, 0, 0, 0],
         [1, 2, 4, 1, 0, 3, 0, 0, 4, 0, 0, 0, 0, 2, 0, 0],
         [0, 0, 0, 3, 1, 2, 1, 0, 0, 0, 0, 0, 2, 0, 0, 0]],
        # grid 13
        [[0, 3, 1, 0, 1, 4, 2, 2, 4, 4, 4, 4, 4, 1, 1],
         [2, 4, 4, 2, 4, 3, 4, 1, 0, 0, 2, 0, 2, 0, 0]],
        # grid 12
        [[1, 1, 4, 4, 1, 4, 4, 1, 1, 4, 2, 1, 0, 1, 2, 0],
         [0, 0, 2, 2, 3, 1, 2, 0, 0, 4, 0, 3, 2, 4, 3, 4],
         [2, 1, 0, 3, 4, 1, 1, 4, 1, 1, 2, 4, 0, 4, 1, 1],
         [1, 4, 2, 1, 1, 0, 2, 1, 1, 2, 1, 0, 0, 0, 0, 0],
         [0, 1, 2, 3, 1, 1, 0, 1, 0, 1, 1, 0, 3, 3, 2, 0]]
    ]

    actual = read_csv(csv_path)

    for grid in expected:
        assert grid in [g.tolist() for g in actual.values()]

    # for name, grid in actual.items():
    #     print(name)
    #     pprint(grid)
